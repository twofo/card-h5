(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-attendanceModule-pages-studentClock-studentClock"],{1317:function(t,e,a){var i=a("d3bb");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=a("4f06").default;o("474b33d2",i,!0,{sourceMap:!1,shadowMode:!1})},"23e1":function(t,e,a){"use strict";a.r(e);var i=a("99f5"),o=a("cb8c");for(var n in o)"default"!==n&&function(t){a.d(e,t,(function(){return o[t]}))}(n);a("5564");var s,l=a("f0c5"),r=Object(l["a"])(o["default"],i["b"],i["c"],!1,null,"400dd035",null,!1,i["a"],s);e["default"]=r.exports},"36e1":function(t,e,a){"use strict";var i;a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){return i}));var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"page"},[a("v-uni-view",{staticClass:"user-info",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.doUserDetail.apply(void 0,arguments)}}},[a("header-pic",{attrs:{pic:t.pic,userInfoCach:t.userInfoCach}})],1),a("v-uni-view",{staticClass:"page__bd center_box"},[a("v-uni-view",{staticClass:"center"},[a("v-uni-view",{staticClass:"center_start"},[a("v-uni-image",{staticClass:"center_image",attrs:{src:t.attendanceImageUrl.start}}),a("v-uni-text",{staticClass:"center_image_right center_text"},[t._v("开始时间："+t._s(t.pageObj.startTimeO))])],1),a("v-uni-view",{staticClass:"center_detail"},[a("v-uni-view",{staticClass:"center_detail_box"},[""!=t.pageObj.checkTimeD?a("v-uni-text",{attrs:{id:"center_detail_text"}},[t._v("打卡时间："+t._s(t.pageObj.checkTimeD))]):a("v-uni-text",{attrs:{id:"center_detail_text"}},[t._v(t._s(t.pageObj.statusMsg))]),a("v-uni-view",{staticClass:"center_detail_position "},[a("v-uni-image",{staticClass:"center_detail_image",attrs:{src:t.attendanceImageUrl.position}}),a("v-uni-text",{attrs:{id:"center_detail_right"}},[t._v(t._s(t.pageObj.checkInLocation))])],1)],1)],1),a("v-uni-view",{staticClass:"center_start"},[a("v-uni-image",{staticClass:"center_image",attrs:{src:t.attendanceImageUrl.end}}),a("v-uni-text",{staticClass:"center_image_right center_text"},[t._v("结束时间："+t._s(t.pageObj.endTimeO))])],1)],1)],1),a("v-uni-view",{staticClass:"page__bd bottom_box page_view center_text"},[a("v-uni-view",{staticClass:"bottom_box_top center_text",style:"background-color:"+t.pageObj.clockColor,on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toClock.apply(void 0,arguments)}}},[a("v-uni-text",{staticClass:"bottom_top_text"},[t._v(t._s(t.pageObj.buttonMsg))]),a("v-uni-text",{staticClass:"bottom_time"},[t._v(t._s(t.nowTime))])],1),a("v-uni-view",{staticClass:"bottom_box_bottom center_text"},[t.pageObj.isInTime&&t.pageObj.isNotClock&&t.pageObj.isInRange||t.pageObj.isClocked?a("v-uni-view",[a("v-uni-image",{staticClass:"bottom_image",attrs:{src:t.attendanceImageUrl.right}})],1):a("v-uni-view",[a("v-uni-image",{staticClass:"bottom_image",attrs:{src:t.attendanceImageUrl.error}})],1),a("v-uni-text",{staticClass:"bottom_text center_text"},[t._v(t._s(t.pageObj.msg))])],1)],1)],1)},n=[]},4749:function(t,e,a){var i=a("df1b");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=a("4f06").default;o("a9d0383c",i,!0,{sourceMap:!1,shadowMode:!1})},4878:function(t,e,a){"use strict";a.r(e);var i=a("36e1"),o=a("7026");for(var n in o)"default"!==n&&function(t){a.d(e,t,(function(){return o[t]}))}(n);a("cdbf");var s,l=a("f0c5"),r=Object(l["a"])(o["default"],i["b"],i["c"],!1,null,"72ee3d66",null,!1,i["a"],s);e["default"]=r.exports},5564:function(t,e,a){"use strict";var i=a("1317"),o=a.n(i);o.a},7026:function(t,e,a){"use strict";a.r(e);var i=a("a061"),o=a.n(i);for(var n in i)"default"!==n&&function(t){a.d(e,t,(function(){return i[t]}))}(n);e["default"]=o.a},"99f5":function(t,e,a){"use strict";var i;a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){return i}));var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"info-hd"},[t.pic.length<=0?a("v-uni-view",{on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.doUserDetail.apply(void 0,arguments)}}},[a("v-uni-image",{staticClass:"user-avatar",attrs:{src:"/static/images/mine/admin-1.png"}})],1):a("v-uni-view",{on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.doUserDetail.apply(void 0,arguments)}}},[a("v-uni-image",{staticClass:"user-avatar",attrs:{src:t.pic}})],1),a("v-uni-view",{staticClass:"info-right",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.doUserDetail.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"user-right-top"},[a("v-uni-text",{staticClass:"user-text username"},[t._v(t._s(t.userInfoCach.name))])],1),a("v-uni-text",{staticClass:"user-text "},[t._v(t._s(t.userInfoCach.username))])],1),t.isMine?[a("v-uni-view",{staticClass:"QRcode",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toCodeDetail.apply(void 0,arguments)}}},[a("v-uni-image",{staticStyle:{width:"60rpx",height:"60rpx"},attrs:{src:"/static/images/mine/QRCode.png"}})],1)]:t._e()],2)},n=[]},a061:function(t,e,a){"use strict";var i=a("4ea4");a("a15b"),a("a9e3"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(a("23e1")),n=getApp(),s=a("eae7"),l={data:function(){return{attendanceImageUrl:s,pic:"",userInfoCach:"",pageObj:{},nowTime:"",title:"不能打卡",clockColor:"#dddddd",is_rang:!0,msg:"",showUuid:"",successShowUuid:"",searching:!1}},components:{headerPic:o.default},props:{},onLoad:function(t){console.log("------------------------考勤打卡------------------------"),""!=t.executePlanId?this.getClockList(t.planId,t.executePlanId):this.getClockList(t.planId)},onShow:function(){n.globalData.getNet||this.setData({msg:"加载失败，请检查网络后重试！"}),""!=this.mag&&this.setData({msg:""}),this.checkBooth();var t=n.globalData.StorageUtil.get("userInfoCach");this.getPicData(t),this.setData({userInfoCach:t})},onUnload:function(){clearInterval(this.myTime)},methods:{getClockList:function(t,e){var a=this;n.globalData.ShowMsgUtil.netErrNotice();var i=n.globalData.StorageUtil.get("userInfoCach"),o=(new Date).getTime();wx.request({url:n.globalData.RequestUrl.attendanceRequestUrl.signInStatusDetail,data:{userId:i.userId,type:1,limitDate:o,planId:t,executePlanId:e},header:{token:i.token,"content-type":"application/json"},method:"POST",success:function(t){if(console.log("获取打卡详情返回",t.data),t.data&&200==t.data.code){var e=t.data.rows[0];e=a.deal(e),console.log("data",e),a.setData({pageObj:e});var i=a.dealStr(e.bluetooth);if(a.setData({showUuid:i}),e.isInTime&&e.isNotClock)if(a.pageObj.msg="不在指定范围",a.pageObj.isInRange=!1,a.setData({pageObj:a.pageObj}),0==e.attendanceMode&&null!=e.bluetooths){console.log("去连信标---",e.bluetooths);for(var o=[],s=0;s<e.bluetooths.length;s++){var l=a.dealStr(e.bluetooths[s]);o.push(l)}a.searchBooth(o)}else if(1==e.attendanceMode&&null!=e.bluetooth){var r=e.random,c=e.bluetooth.substring(0,e.bluetooth.length-1),d=e.bluetooth.substring(0,e.bluetooth.length-2);console.log("去连信标---",e.bluetooths);o=[];for(var u="",g=r;g>0;g--){u=g<10?c+g:d+g;var b=a.dealStr(u);o.push(b)}console.log("去连信标---",o),a.searchBooth(o)}}else n.globalData.ShowMsgUtil.showErrorModal("请求失败",t.data.msg,t.data.code)},fail:function(){n.globalData.ShowMsgUtil.showNoneToastByFail()}})},dealStr:function(t){var e=[];return null!=t&&""!=t&&32==t.length?(e[0]=t.substring(0,8),e[1]=t.substring(8,12),e[2]=t.substring(12,16),e[3]=t.substring(16,20),e[4]=t.substring(20,t.length),e.join("-")):null},deal:function(t){return t.startTimeO=n.globalData.PublicUtil.formatTimeTwo(Number(t.startTime),"h:m"),t.endTimeO=n.globalData.PublicUtil.formatTimeTwo(Number(t.endTime),"h:m"),t=this.getStatusName(t),t=this.getShowMsg(t),t},getStatusName:function(t){return 20==t.status?t.checkStatusName="正常":21==t.status?t.checkStatusName="未签到":22==t.status?t.checkStatusName="迟到":23==t.status?t.checkStatusName="请假":24==t.status?t.checkStatusName="补签":25==t.status?t.checkStatusName="无需签到":26==t.status&&(t.checkStatusName="可能签到"),t},getShowMsg:function(t){if(t.clockColor="#dddddd",t.isClocked=!1,t.checkTimeD="",20==t.status||22==t.status||23==t.status||24==t.status)return wx.hideToast(),t.statusMsg="已打卡",t.buttonMsg="已打卡",t.isNotClock=!1,t.clockColor="#86CDAD",t.msg="你已打卡成功！",t.isInTime=!1,t.isClocked=!0,t.checkTimeD=n.globalData.PublicUtil.formatTimeTwo(Number(t.checkTime),"Y-M-D h:m"),t;if(21!=t.status&&25!=t.status&&null!=t.status&&26!=t.status)return wx.hideToast(),t.statusMsg="未知",t.isNotClock=!1,t.buttonMsg="未知",t.msg="未知情况",t.isInTime=!1,t;t.statusMsg="未打卡",t.buttonMsg="不能打卡",t.isNotClock=!0;var e=(new Date).getTime(),a=new Date(t.endTime),i=a.getMinutes();return a.setMinutes(i+t.floatTime),a=n.globalData.PublicUtil.formatTimeTwo(Number(a),"h:m"),n.globalData.PublicUtil.formatTimeTwo(Number(e),"h:m")<=a&&n.globalData.PublicUtil.formatTimeTwo(Number(e),"h:m")>=n.globalData.PublicUtil.formatTimeTwo(Number(t.startTime),"h:m")?(t.msg="在指定的时间内",t.isInTime=!0):(t.msg="不在指定的时间内",t.isInTime=!1),t},searchBooth:function(t){var e=this;console.log("------------------------------------------------------------------------------------------------------"),console.log("蓝牙信标扫描uuid",t),wx.startBeaconDiscovery({uuids:t,success:function(){wx.hideToast(),console.log("扫描到"),n.globalData.ShowMsgUtil.showLoadAndMsgToast("扫描设备中！",6e5),console.log("开始扫描设备..."),wx.onBeaconUpdate((function(t){if(console.log(t.beacons),t&&t.beacons&&t.beacons.length>0){wx.hideToast(),e.pageObj.msg="在指定范围",e.pageObj.isInRange=!0,e.pageObj.buttonMsg="立即打卡",e.pageObj.clockColor="#4fc08d",e.setData({successShowUuid:t.beacons[0].uuid});var a=e.dealStrReturn(t.beacons[0].uuid);return console.log("res.beacons",t.beacons),console.log("bluetoothId",a.toLowerCase()),console.log("------------------------------------------------------------------------------------------------------"),e.pageObj.bluetoothId=a.toLowerCase(),void e.setData({pageObj:e.pageObj})}}))},fail:function(){console.log("未扫描到")}}),setTimeout((function(){wx.stopBeaconDiscovery({success:function(){wx.hideToast(),n.globalData.ShowMsgUtil.showErrorModal("扫描失败","扫描蓝牙超时！")}})}),6e5)},toClock:function(){var t=this;n.globalData.ShowMsgUtil.netErrNotice();var e=n.globalData.StorageUtil.get("userInfoCach"),a=(new Date).getTime(),i=t.pageObj;i.isInTime&&i.isNotClock&&i.isInRange&&wx.request({url:n.globalData.RequestUrl.attendanceRequestUrl.signIn,data:{personId:e.personId,personType:e.personType,planId:i.planId,executePlanId:i.executePlanId,terminalIdentification:a,type:1,terminalType:38,roomId:i.roomId,bluetoothId:i.bluetoothId},method:"POST",header:{token:e.token,"content-type":"application/json"},success:function(t){console.log("考勤打卡请求返回",t.data),t.data&&200==t.data.code?(console.log("考勤打卡成功"),n.globalData.ShowMsgUtil.showSuccessToast("打卡成功",2e3),n.globalData.PublicUtil.switchTabByUrl(n.globalData.PageUrl.taBarPageUrl.indexUrl,2e3)):n.globalData.ShowMsgUtil.showErrorModal("请求失败",t.data.msg,t.data.code)},fail:function(){n.globalData.ShowMsgUtil.showNoneToastByFail()}})},getPicData:function(t){var e=this;n.globalData.ShowMsgUtil.netErrNotice(),wx.request({url:n.globalData.RequestUrl.baseRequestUrl.getImage,header:{token:t.token},method:"GET",success:function(t){console.log("获取头像",t.data),t.data&&200===t.data.code&&e.setData({pic:t.data.rows.url})},fail:function(){n.globalData.ShowMsgUtil.showNoneToastByFail()}})},dealStrReturn:function(t){var e=[];return null!=t&&""!=t&&36==t.length?(e[0]=t.substring(0,8),e[1]=t.substring(9,13),e[2]=t.substring(14,18),e[3]=t.substring(19,23),e[4]=t.substring(24,t.length),e[0]+e[1]+e[2]+e[3]+e[4]):null},checkBooth:function(){var t=this;t.searching?wx.stopBluetoothDevicesDiscovery({success:function(e){console.log(e),t.setData({searching:!1})}}):wx.closeBluetoothAdapter({complete:function(t){wx.openBluetoothAdapter({success:function(t){wx.getBluetoothAdapterState({success:function(t){console.log("已打开蓝牙")}})},fail:function(t){wx.hideToast({}),wx.showModal({title:"提示",content:"请检查手机蓝牙是否打开",showCancel:!1,confirmColor:"#20a4f7",success:function(t){console.log("没有打开蓝牙")}})}})}})}}};e.default=l},a6cb:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={data:function(){return{}},components:{},props:{userInfoCach:{type:Object,default:function(){return{}}},pic:{type:String,default:""},isMine:{type:Boolean,default:!1}},methods:{toCodeDetail:function(){this.$emit("qrcode",{detail:{}})},doUserDetail:function(){this.$emit("userdetail",{detail:{}})}}};e.default=i},cb8c:function(t,e,a){"use strict";a.r(e);var i=a("a6cb"),o=a.n(i);for(var n in i)"default"!==n&&function(t){a.d(e,t,(function(){return i[t]}))}(n);e["default"]=o.a},cdbf:function(t,e,a){"use strict";var i=a("4749"),o=a.n(i);o.a},d3bb:function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,"/* components/mineModule/mineHeader/mineHeader.wxss */.info-hd[data-v-400dd035]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;align-items:center;color:#fff}.user-avatar[data-v-400dd035]{width:%?130?%;height:%?130?%;border-radius:50%;margin-top:%?6?%}.info-right[data-v-400dd035]{\r\n  /* border: 1px red solid; */width:65%;padding-left:20px;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;font-size:14px}.user-right-top[data-v-400dd035]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row}.user-text[data-v-400dd035]{font-size:%?28?%}.username[data-v-400dd035]{width:%?500?%;font-size:%?34?%;font-weight:550}.QRcode[data-v-400dd035]{width:%?60?%;height:%?60?%}",""]),t.exports=e},df1b:function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,".center_text[data-v-72ee3d66]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center}.center_box[data-v-72ee3d66]{display:-webkit-flex; /* Safari */display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;padding-left:%?30?%}.center_start[data-v-72ee3d66]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row}.center_image[data-v-72ee3d66]{width:%?50?%;height:%?50?%;border-radius:5px;margin-top:%?6?%}.center_image_right[data-v-72ee3d66]{color:#999;margin-left:%?40?%;font-size:%?32?%}.center_detail[data-v-72ee3d66]{display:-webkit-flex; /* Safari */display:-webkit-box;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;width:80%;height:%?180?%;border-left:2px solid #999;margin-left:%?25?%}.center_detail_box[data-v-72ee3d66]{margin-left:%?100?%}#center_detail_text[data-v-72ee3d66]{color:#333\r\n  /* font-size: 50rpx; */}.center_detail_image[data-v-72ee3d66]{width:%?40?%;height:%?40?%}#center_detail_right[data-v-72ee3d66]{margin-left:%?20?%;color:#999}.center_detail_position[data-v-72ee3d66]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;margin-top:%?25?%}.bottom_box[data-v-72ee3d66]{width:100%;height:%?400?%;display:-webkit-flex; /* Safari */display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;margin-top:%?25?%}.bottom_box_top[data-v-72ee3d66]{width:%?300?%;height:%?300?%;color:#fff;border-radius:%?150?%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column}.bottom_top_text[data-v-72ee3d66]{font-size:%?40?%;margin-top:%?25?%}.bottom_time[data-v-72ee3d66]{margin-top:%?25?%}.bottom_box_bottom[data-v-72ee3d66]{width:%?600?%;height:%?100?%;margin-top:%?20?%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row}.bottom_image[data-v-72ee3d66]{width:%?45?%;height:%?45?%}.bottom_text[data-v-72ee3d66]{margin-left:%?20?%}.user-info[data-v-72ee3d66]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;\r\n  /* border: 1px red solid; */background-color:#fff;background:#20a4f7;min-height:%?170?%;margin-bottom:%?30?%;padding:%?30?% %?30?% %?0?%}",""]),t.exports=e},eae7:function(t,e){var a="/static/pages/attendanceModule/resources/pic",i={image:a,deletePic:"".concat(a,"/delete.png"),approvalAgree:"".concat(a,"/approval_agree.png"),approvalReject:"".concat(a,"/approval_reject.png"),clock:"".concat(a,"/clock.png"),attendaceStatistics:"".concat(a,"/attendaceStatistics.png"),position:"".concat(a,"/position.png"),error:"".concat(a,"/error.png"),right:"".concat(a,"/right.png"),msg:"".concat(a,"/msg.png"),start:"".concat(a,"/start.png"),end:"".concat(a,"/end.png"),camera:"".concat(a,"/camera.png")};t.exports=i}}]);