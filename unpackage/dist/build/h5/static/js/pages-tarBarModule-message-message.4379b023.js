(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-tarBarModule-message-message"],{"0eb4":function(e,a,t){"use strict";var i;t.d(a,"b",(function(){return l})),t.d(a,"c",(function(){return n})),t.d(a,"a",(function(){return i}));var l=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("v-uni-view",{class:"weui-tabbar "+e.extClass},e._l(e.list,(function(a,i){return t("v-uni-view",{key:i,class:"weui-tabbar__item "+(i===e.current?"weui-bar__item_on":""),on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.tabChange(i)}}},[t("v-uni-view",{staticStyle:{position:"relative",display:"inline-block",width:"28px",height:"28px"}},[t("v-uni-image",{staticClass:"weui-tabbar__icon",attrs:{src:e.current===i?a.selectedIconPath:a.iconPath}})],1),t("v-uni-view",{staticClass:"weui-tabbar__label"},[e._v(e._s(a.text))])],1)})),1)},n=[]},1079:function(e,a,t){var i=t("1fef");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var l=t("4f06").default;l("32a40d3e",i,!0,{sourceMap:!1,shadowMode:!1})},"1fef":function(e,a,t){var i=t("24fb");a=i(!1),a.push([e.i,".background-content[data-v-e1e0353a]{position:relative;z-index:1}.background-up[data-v-e1e0353a]{position:absolute;z-index:2;margin:3% 4% 0 4%;width:92%}.background-up-top[data-v-e1e0353a]{background-color:#fff;box-shadow:0 0 1px 0 rgba(110,113,176,.5);display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;padding:%?30?% %?0?%;font-size:15px}\r\n/* 头部功能 */.wx-items[data-v-e1e0353a]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-align-content:center;align-content:center;-webkit-box-pack:left;-webkit-justify-content:left;justify-content:left}.wx-item[data-v-e1e0353a]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column}.item-image[data-v-e1e0353a]{width:36px;height:36px;position:relative;z-index:10}.item-red-point[data-v-e1e0353a]{width:10px;height:10px;\r\n  /* border: 1px skyblue solid; */position:absolute;z-index:11;margin:3px 0 0 30px}.item-name[data-v-e1e0353a]{margin-top:3px;text-align:center;font-size:11px}\r\n/* 消息列表 */.myui-cell[data-v-e1e0353a]{position:relative;display:-webkit-box;display:-webkit-flex;display:flex}.msg-title[data-v-e1e0353a]{margin:4% 2% 0 2%;font-size:13px;color:#575757;height:30px}.myui-read[data-v-e1e0353a]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.content[data-v-e1e0353a]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;padding:%?10?% %?20?% 0}.content-ending[data-v-e1e0353a]{width:100%;color:#bbb;text-align:center;margin:%?30?% auto}",""]),e.exports=a},"3ab4":function(e,a,t){"use strict";t("a9e3"),Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var i={data:function(){return{}},components:{},props:{extClass:{type:String,default:""},list:{type:Array,default:function(){return[]}},current:{type:Number,default:0}},options:{addGlobalClass:!0},methods:{tabChange:function(e){console.log(e);var a=e;a!==this.current&&(this.setData({current:a}),this.$emit("change",{detail:{index:a,item:this.list[a]}}))}}};a.default=i},"4cea":function(e,a,t){"use strict";var i=t("4ea4");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var l=i(t("11f5")),n=i(t("8836")),o=getApp(),s=o.globalData.ImageUrl,r={data:function(){return{windowHeight:0,windowWidth:0,pageData:{showOfNewest:[]},ImageUrl:s,alarmNewsTypeList:[],page:0,active:{data:[],showMore:!0,remind:"上滑加载更多"},data:[],loading:!1,disabledRemind:!1,pullDownNumber:0,role:"",count:0,userInfoCach:"",current:1,tabBarList:[{text:"首页",iconPath:"/static/images/tabBar/index.png",selectedIconPath:"/static/images/tabBar/index@active.png",pagePath:"/pages/tarBarModule/index/index"},{text:"消息",iconPath:"/static/images/tabBar/news.png",selectedIconPath:"/static/images/tabBar/news@active.png",pagePath:"/pages/tarBarModule/message/message"},{text:"我的",iconPath:"/static/images/tabBar/more.png",selectedIconPath:"/static/images/tabBar/more@active.png",pagePath:"/pages/tarBarModule/mine/mine"}],showOnlyABC:o.globalData.showOnlyABC}},components:{newLists:l.default,mpTabbar:n.default},mounted:function(){this.showOnlyABC||(document.querySelector(".uni-page-head-hd").style.display="none")},onLoad:function(){console.log("------------------------消息模块------------------------");var e=o.globalData.StorageUtil.get("userInfoCach");this.setData({windowHeight:wx.getSystemInfoSync().windowHeight,windowWidth:wx.getSystemInfoSync().windowWidth,userInfoCach:e}),this.getOptions(),this.getNewest()},onShow:function(){uni.$on("bindDealMsg",this.bindDealMsg),uni.$on("getMore",this.getMore);var e=this.count;0!=e&&(this.getOptions(),this.getNewest()),this.setData({count:1})},onHide:function(){uni.$off("bindDealMsg",this.bindDealMsg),uni.$off("getMore",this.getMore)},onUnload:function(){uni.$off("bindDealMsg",this.bindDealMsg),uni.$off("getMore",this.getMore)},onPullDownRefresh:function(){this.getOptions(),this.getNewest()},methods:{tabChange:function(e){console.log(e);var a=e.detail.index;if(1!=a){var t=e.detail.item.pagePath;console.log(t),uni.reLaunch({url:t})}},getOptions:function(){var e=this;o.globalData.ShowMsgUtil.netErrNotice();var a=o.globalData.StorageUtil.get("userInfoCach");wx.request({url:o.globalData.RequestUrl.appoprRequestUrl.unreadStatistics,method:"GET",header:{token:a.token},success:function(a){if(console.log("获取消息功能选项",a.data.rows),a.data&&200==a.data.code)e.dealShowOfOptions(a.data.rows);else{var t=[{type:1,allRead:!0},{type:2,allRead:!0},{type:3,allRead:!0}];e.dealShowOfOptions(t),o.globalData.ShowMsgUtil.showErrorModal("请求失败",a.data.msg,a.data.code)}},fail:function(){var a=[{type:1,allRead:!0},{type:2,allRead:!0},{type:3,allRead:!0}];e.dealShowOfOptions(a),o.globalData.ShowMsgUtil.showNoneToastByFail()},complete:function(){uni.stopPullDownRefresh()}})},getMore:function(e){console.log("消息页面点击详情  ------------",e),console.log(this.pageData);var a=e.detail.index;this.type;if(this.pageData.showOfNewest.length>0){this.pageData.showOfNewest[a].childType;var t=this.pageData.showOfNewest[a].id,i=this.pageData.showOfNewest[a].msg;"已读"!=i&&this.markRead({mid:t}),console.log(t),o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.indexPageUrl.messageDetailUrl+"?mid="+t,500)}},dealShowOfOptions:function(e){if(console.log(">>>>>>>>>>>>data",e),0==e.length)return this.pageData.showOptions=[],void this.setData({pageData:this.pageData});for(var a=[s.msgPay,s.msgAttendance,s.msgAlarm,s.msgOther,s.msgNotice,s.msgRepair],t=0;t<e.length;t++)e[t].image=a[e[t].type-1],e[t].allRead||(e[t].allUnreadImage=s.msgClue);this.pageData.showOptions=e,this.setData({pageData:this.pageData})},getNewest:function(){var e=this;o.globalData.ShowMsgUtil.netErrNotice();var a=o.globalData.StorageUtil.get("userInfoCach");wx.request({url:o.globalData.RequestUrl.appoprRequestUrl.getNewest+"/5",method:"GET",header:{token:a.token},success:function(a){if(console.log("获取当日最新消息",a.data),a.data&&200==a.data.code){var t=a.data.rows.length;e.pageData.todayNewNumber=t,e.setData({pageData:e.pageData}),e.dealShowOfNewest(a.data.rows)}else e.handleError(),o.globalData.ShowMsgUtil.showNoneToastByFail()},fail:function(){e.handleError(),o.globalData.ShowMsgUtil.showNoneToastByFail()}})},dealShowOfNewest:function(e){if(0==e.length)return this.pageData.showOfNewest=[],void this.setData({pageData:this.pageData});for(var a=[],t=0;t<e.length;t++){var i={};i.id=e[t].id,i.typeName=this.dealMsgType(e[t].type),i.messageTitle=e[t].messageTitle,i.messageContent=e[t].messageContent,i.messageSendTime=e[t].messageSendTime,i.msg=0==e[t].messageRead?"未读":"已读",i.type=e[t].type,i.childType=e[t].childType,i.wxMessagePageValue=e[t].wxMessagePageValue,i.extras=e[t].extras,console.log(i.extras),0==e[t].messageRead&&(i.image=s.msgClue),a[t]=i}this.pageData.showOfNewest=a,this.setData({pageData:this.pageData})},dealMsgType:function(e){var a="";switch(e){case 1:a="支付";break;case 2:a="考勤";break;case 3:a="告警";break;case 4:a="其他";break;case 5:a="公告";break;case 6:a="报修";break;default:break}return a},handleError:function(e){this.pageData.todayNewNumber=0,this.pageData.showOfNewest=[],this.setData({pageData:this.pageData})},bindToAllRead:function(){var e=!1,a=this.pageData;if(a.showOptions.length>0)for(var t=0;t<a.showOptions.length;t++)a.showOptions[t].allRead||(e=!0);if(a.showOfNewest.length>0)for(var i=0;i<a.showOfNewest.length;i++)"未读"===a.showOfNewest[i].msg&&(e=!0);if(e){var l={markAll:!0};this.markRead(l)}},markRead:function(e){var a=this;o.globalData.ShowMsgUtil.netErrNotice();var t=o.globalData.StorageUtil.get("userInfoCach");wx.request({url:o.globalData.RequestUrl.appoprRequestUrl.markRead,data:e,header:{token:t.token},method:"POST",success:function(e){e.data&&200==e.data.code&&(a.getOptions(),a.getNewest())},fail:function(){o.globalData.ShowMsgUtil.showNoneToastByFail()},complete:function(){wx.hideNavigationBarLoading()}})},bindDealMsg:function(e){console.log("父组件点击",e),console.log(this.pageData.showOfNewest[2]);var a=e.detail.index,t=e.detail.type,i=this.pageData.showOfNewest[a].childType,l=this.pageData.showOfNewest[a].id,n=this.pageData.showOfNewest[a].msg,o=this.pageData.showOfNewest[a].extras,s=(o=JSON.parse(o),""==this.pageData.showOfNewest[a].extras?null:this.pageData.showOfNewest[a].wxMessagePageValue);this.dealMsg(t,i,l,n,s,o)},dealMsg:function(e,a,t,i,l,n){console.log(e,a,t,i,l);var s=l,r=o.globalData.StorageUtil.get("userInfoCach");if(2==e||null!==r.role||""!==r.role){var g={mid:t};"已读"!=i&&this.markRead(g),s&&(o.globalData.ShowMsgUtil.showLoadToast("正在跳转",500),1==s.msgType?1==s.childMsgType||2==s.childMsgType||3==s.childMsgType||4==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.appointmentPageUrl.attendPianoDetailUrl+"?meetingId="+s.id+"&type=2",500):(6==s.childMsgType||5==s.childMsgType)&&o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.appointmentPageUrl.attendPianoDetailUrl+"?meetingId="+s.id+"&type=2&conflict=1",500):2==s.msgType?1==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.appointmentPageUrl.attendMeetingDetailUrl+"?meetingId="+s.id,500):2==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.indexPageUrl.approvalInfoUrl,500):3==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.appointmentPageUrl.meetingDetailUrl+"?meetingId="+s.id,500):4==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.indexPageUrl.approvalInfoUrl,500):5==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.appointmentPageUrl.attendMeetingDetailUrl+"?meetingId="+s.id,500):6==s.childMsgType?wx.hideToast():7==s.childMsgType&&o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.appointmentPageUrl.attendMeetingDetailUrl+"?meetingId="+s.id,500):3==s.msgType?1==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.attendancePageUrl.studentClockUrl+"?planId="+s.id+"&executePlanId="+s.executePlanId,500):2==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.indexPageUrl.approvalInfoUrl,500):3==s.childMsgType&&o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.repairPageUrl.repairManageUrl+"?planId="+s.id,500):4==s.msgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.repairPageUrl.studentRepairDetailUrl+"?repairCode="+n.repairCode,500):5==s.msgType&&(1==s.childMsgType||2==s.childMsgType||3==s.childMsgType||4==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.appointmentPageUrl.attendPianoDetailUrl+"?meetingId="+s.id+"&type=3",500):5==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.appointmentPageUrl.attendPianoDetailUrl+"?meetingId="+s.id+"&type=3&conflict=1",500):6==s.childMsgType?o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.indexPageUrl.approvalInfoUrl,500):(7==s.childMsgType||8==s.childMsgType)&&o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.appointmentPageUrl.attendPianoDetailUrl+"?meetingId="+s.id+"&type=3",500)))}else e==o.globalData.Constant.messageTypeConstant.REPAIR_TYPE&&a==o.globalData.Constant.messageTypeConstant.REPAIR_STATUS_CHILD_TYPE||("已读"!=i&&this.markRead({mid:t}),o.globalData.PublicUtil.navigateByUrl(o.globalData.PageUrl.indexPageUrl.messageDetailUrl+"?mid="+t,500))}}};a.default=r},"5f7a":function(e,a,t){var i=t("952e");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var l=t("4f06").default;l("9869a900",i,!0,{sourceMap:!1,shadowMode:!1})},"60db":function(e,a,t){"use strict";t.r(a);var i=t("3ab4"),l=t.n(i);for(var n in i)"default"!==n&&function(e){t.d(a,e,(function(){return i[e]}))}(n);a["default"]=l.a},7338:function(e,a,t){"use strict";var i=t("5f7a"),l=t.n(i);l.a},"77a9":function(e,a,t){"use strict";var i;t.d(a,"b",(function(){return l})),t.d(a,"c",(function(){return n})),t.d(a,"a",(function(){return i}));var l=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("v-uni-view",{staticClass:"page"},[t("v-uni-view",{staticClass:"page__bd background-content"},[t("v-uni-view",{staticClass:"background-up"},[t("v-uni-view",{staticClass:"background-up-top",style:"width: "+.92*e.windowWidth+"px;border-radius: 10px;"},[t("v-uni-view",{staticClass:"wx-items"},e._l(e.pageData.showOptions,(function(a,i){return t("v-uni-view",{key:i},[t("v-uni-navigator",{attrs:{url:"/pages/indexModule/pages/messageListOfType/messageListOfType?type="+a.type}},[i<5?t("v-uni-view",{staticClass:"wx-item",style:"height:60px;width: 32px;margin:"+.3*e.windowHeight*.08+"px "+.99*e.windowWidth*.05+"px;"},[t("v-uni-image",{staticClass:"item-image",attrs:{src:a.image}}),t("v-uni-image",{staticClass:"item-red-point",attrs:{src:a.allUnreadImage}}),t("v-uni-text",{staticClass:"item-name"},[e._v(e._s(a.name))])],1):e._e()],1)],1)})),1)],1),t("v-uni-view",{staticClass:"msg-title"},[t("v-uni-view",{staticClass:"myui-cell"},[t("v-uni-view",{staticClass:"weui-cell__bd"},[e._v("今日消息（"+e._s(e.pageData.todayNewNumber)+"/5）")]),t("v-uni-view",{staticClass:"weui-cell__ft myui-read",on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.bindToAllRead.apply(void 0,arguments)}}},[t("v-uni-view",{staticStyle:{display:"flex","justify-content":"center"}},[t("v-uni-image",{staticStyle:{width:"18px",height:"15px",margin:"0px 8px"},attrs:{src:e.ImageUrl.msgUnread}})],1),t("v-uni-view",[e._v("一键全部已读")])],1)],1)],1),e.pageData.showOfNewest.length>0?t("v-uni-view",[t("new-lists",{attrs:{alarmNewsList:e.pageData.showOfNewest,height:e.windowHeight-200,itemHeight:106},on:{bindDealMsg:function(a){arguments[0]=a=e.$handleEvent(a),e.bindDealMsg.apply(void 0,arguments)},getMore:function(a){arguments[0]=a=e.$handleEvent(a),e.getMore.apply(void 0,arguments)}}})],1):t("v-uni-view",{staticStyle:{"margin-top":"30%"}},[t("v-uni-view",{staticClass:"weui-loadmore weui-loadmore_line"},[t("v-uni-view",{staticClass:"weui-loadmore__tips weui-loadmore__tips_in-line"},[e._v("暂无数据")])],1),t("v-uni-view",{staticClass:"weui-loadmore weui-loadmore_line weui-loadmore_dot"},[t("v-uni-view",{staticClass:"weui-loadmore__tips weui-loadmore__tips_in-line weui-loadmore__tips_in-dot"})],1)],1)],1),t("v-uni-view",{staticClass:"background-top",style:"height: "+.12*e.windowHeight+"px; width: 100%;background-color: rgb(32,164,247);"}),t("v-uni-view",{staticClass:"background-bottom",style:"height: "+(.88*e.windowHeight-7)+"px; width: 100%;"})],1),e.showOnlyABC?e._e():t("mp-tabbar",{staticStyle:{position:"fixed",bottom:"0",width:"100%",left:"0",right:"0"},attrs:{list:e.tabBarList,current:e.current},on:{change:function(a){arguments[0]=a=e.$handleEvent(a),e.tabChange.apply(void 0,arguments)}}})],1)},n=[]},8836:function(e,a,t){"use strict";t.r(a);var i=t("0eb4"),l=t("60db");for(var n in l)"default"!==n&&function(e){t.d(a,e,(function(){return l[e]}))}(n);t("7338");var o,s=t("f0c5"),r=Object(s["a"])(l["default"],i["b"],i["c"],!1,null,"1a64f049",null,!1,i["a"],o);a["default"]=r.exports},"952e":function(e,a,t){var i=t("24fb");a=i(!1),a.push([e.i,'/* components/common/tarbBar/tarbBar.wxss */\r\n/*!\r\n * WeUI v2.0.0 (https://github.com/weui/weui-wxss)\r\n * Copyright 2019 Tencent, Inc.\r\n * Licensed under the MIT license\r\n */.weui-tabbar[data-v-1a64f049]{display:-webkit-box;display:-webkit-flex;display:flex;position:relative;z-index:500;background-color:#f7f7f7}.weui-tabbar[data-v-1a64f049]:before{content:" ";position:absolute;left:0;top:0;right:0;height:1px;border-top:%?1?% solid rgba(0,0,0,.1);color:rgba(0,0,0,.1)}.weui-tabbar__item[data-v-1a64f049]{display:block;-webkit-box-flex:1;-webkit-flex:1;flex:1;padding:8px 0 4px;padding-bottom:calc(8px + constant(safe-area-inset-bottom));padding-bottom:calc(8px + env(safe-area-inset-bottom));font-size:0;color:rgba(0,0,0,.5);text-align:center;-webkit-tap-highlight-color:rgba(0,0,0,0)}.weui-tabbar__item[data-v-1a64f049]:first-child{padding-left:constant(safe-area-inset-left);padding-left:env(safe-area-inset-left)}.weui-tabbar__item[data-v-1a64f049]:last-child{padding-right:constant(safe-area-inset-right);padding-right:env(safe-area-inset-right)}.weui-tabbar__item.weui-bar__item_on .weui-tabbar__icon[data-v-1a64f049],.weui-tabbar__item.weui-bar__item_on .weui-tabbar__icon>i[data-v-1a64f049],.weui-tabbar__item.weui-bar__item_on .weui-tabbar__label[data-v-1a64f049]{color:#20a4f7}.weui-tabbar__icon[data-v-1a64f049]{display:inline-block;width:28px;height:28px;margin-bottom:2px}.weui-tabbar__icon>i[data-v-1a64f049],i.weui-tabbar__icon[data-v-1a64f049]{font-size:24px;color:rgba(0,0,0,.5)}.weui-tabbar__icon uni-image[data-v-1a64f049]{width:100%;height:100%}.weui-tabbar__label[data-v-1a64f049]{color:rgba(0,0,0,.9);font-size:10px;line-height:1.4;margin:%?0?% 0 %?-10?%}',""]),e.exports=a},"9e79":function(e,a,t){"use strict";t.r(a);var i=t("77a9"),l=t("d15d");for(var n in l)"default"!==n&&function(e){t.d(a,e,(function(){return l[e]}))}(n);t("a2fe");var o,s=t("f0c5"),r=Object(s["a"])(l["default"],i["b"],i["c"],!1,null,"e1e0353a",null,!1,i["a"],o);a["default"]=r.exports},a2fe:function(e,a,t){"use strict";var i=t("1079"),l=t.n(i);l.a},d15d:function(e,a,t){"use strict";t.r(a);var i=t("4cea"),l=t.n(i);for(var n in i)"default"!==n&&function(e){t.d(a,e,(function(){return i[e]}))}(n);a["default"]=l.a}}]);