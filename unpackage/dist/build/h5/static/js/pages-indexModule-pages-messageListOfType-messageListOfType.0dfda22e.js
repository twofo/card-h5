(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-indexModule-pages-messageListOfType-messageListOfType"],{"03da":function(e,a,t){"use strict";var i=t("d831"),l=t.n(i);l.a},"0bcc":function(e,a,t){"use strict";t.r(a);var i=t("f218"),l=t.n(i);for(var n in i)"default"!==n&&function(e){t.d(a,e,(function(){return i[e]}))}(n);a["default"]=l.a},"0c4d":function(e,a,t){"use strict";t.r(a);var i=t("a6f7"),l=t("0bcc");for(var n in l)"default"!==n&&function(e){t.d(a,e,(function(){return l[e]}))}(n);t("03da");var s,o=t("f0c5"),g=Object(o["a"])(l["default"],i["b"],i["c"],!1,null,"f0dce978",null,!1,i["a"],s);a["default"]=g.exports},a6f7:function(e,a,t){"use strict";var i;t.d(a,"b",(function(){return l})),t.d(a,"c",(function(){return n})),t.d(a,"a",(function(){return i}));var l=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("v-uni-view",{staticClass:"pages"},[t("v-uni-view",{staticClass:"page__bd"},[t("v-uni-view",{staticClass:"msg-title"},[t("v-uni-view",{staticClass:"myui-cell"},[t("v-uni-view",{staticClass:"weui-cell__bd"},[e._v("消息列表")]),t("v-uni-view",{staticClass:"weui-cell__ft myui-read",on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.bindToAllRead.apply(void 0,arguments)}}},[t("v-uni-view",{staticStyle:{display:"flex","justify-content":"center"}},[t("v-uni-image",{staticStyle:{width:"18px",height:"16px",margin:"0px 10px"},attrs:{src:e.ImageUrl.msgUnread}})],1),t("v-uni-view",[e._v("一键已读")])],1)],1)],1),e.pageData.alarmTypeNews.length>0?t("v-uni-view",{staticClass:"lists"},[t("new-lists",{attrs:{alarmNewsList:e.pageData.alarmTypeNews,height:.9*e.windowHeight,listLength:e.listLength,itemHeight:e.itemHeight,type:e.type},on:{bindDealMsg:function(a){arguments[0]=a=e.$handleEvent(a),e.bindDealMsg.apply(void 0,arguments)},getMore:function(a){arguments[0]=a=e.$handleEvent(a),e.getMore.apply(void 0,arguments)},bindPullUp:function(a){arguments[0]=a=e.$handleEvent(a),e.bindPullUp.apply(void 0,arguments)}}})],1):t("v-uni-view",{staticStyle:{"margin-top":"50%"}},[t("v-uni-view",{staticClass:"weui-loadmore weui-loadmore_line"},[t("v-uni-view",{staticClass:"weui-loadmore__tips weui-loadmore__tips_in-line"},[e._v("暂无数据")])],1),t("v-uni-view",{staticClass:"weui-loadmore weui-loadmore_line weui-loadmore_dot"},[t("v-uni-view",{staticClass:"weui-loadmore__tips weui-loadmore__tips_in-line weui-loadmore__tips_in-dot"})],1)],1)],1)],1)},n=[]},d831:function(e,a,t){var i=t("e48f");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var l=t("4f06").default;l("0bec033c",i,!0,{sourceMap:!1,shadowMode:!1})},e48f:function(e,a,t){var i=t("24fb");a=i(!1),a.push([e.i,".myui-cell[data-v-f0dce978]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;margin:auto 15px}.msg-title[data-v-f0dce978]{font-size:14px;height:38px;line-height:38px;background-color:#fff}.myui-read[data-v-f0dce978]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.lists[data-v-f0dce978]{padding:5px 1.5%}",""]),e.exports=a},f218:function(e,a,t){"use strict";var i=t("4ea4");t("e25e"),Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var l=i(t("11f5")),n=getApp(),s=n.globalData.ImageUrl,o={data:function(){return{windowHeight:0,windowWidth:0,pageData:{alarmTypeNews:[]},ImageUrl:s,type:0,pullDownNumber:0,listLength:1,itemHeight:126,disabled:!1}},components:{newLists:l.default},onLoad:function(e){console.log(e);var a=e.type;""!=a&&null!=a||(n.globalData.ShowMsgUtil.showErrorModal("显示失败","详情显示失败！"),setTimeout((function(){wx.hideToast(),wx.navigateBack({delta:1})}),2e3)),console.log(typeof a);var t=1==a?76:106;this.setData({itemHeight:t,type:parseInt(a)}),this.getListByType(this.type,1,5),this.setData({windowHeight:wx.getSystemInfoSync().windowHeight,windowWidth:wx.getSystemInfoSync().windowWidth})},onShow:function(){uni.$on("bindPullUp",this.bindPullUp),uni.$on("bindDealMsg",this.bindDealMsg),uni.$on("getMore",this.getMore),this.getListByType(this.type,1,5),this.disabled=!1},onHide:function(){uni.$off("bindPullUp",this.bindPullUp),uni.$off("bindDealMsg",this.bindDealMsg),uni.$off("getMore",this.getMore)},onUnload:function(){uni.$off("bindPullUp",this.bindPullUp),uni.$off("bindDealMsg",this.bindDealMsg),uni.$off("getMore",this.getMore)},onPullDownRefresh:function(){this.setData({pageData:{},pullDownNumber:0}),this.getListByType(this.type,1,5)},methods:{getListByType:function(e,a,t){var i=this;n.globalData.ShowMsgUtil.netErrNotice();var l=n.globalData.StorageUtil.get("userInfoCach"),s=n.globalData.PublicUtil.isNotEmpty(i.pageData,this)?i.pageData.alarmTypeNews.length:0;wx.request({url:n.globalData.RequestUrl.appoprRequestUrl.getListByType,data:{type:e,pageNumber:a,pageSize:t},header:{token:l.token},method:"POST",success:function(e){console.log("获取一类消息数据",e.data.rows),e.data&&200==e.data.code?(i.pullDownNumber++,i.dealShowOfNewest(e.data.rows),i.setData({listLength:s})):n.globalData.ShowMsgUtil.showErrorModal("请求失败",e.data.msg,e.data.code)},fail:function(){n.globalData.ShowMsgUtil.showNoneToast("后台连接失败",2e3)},complete:function(){wx.hideToast(),wx.hideNavigationBarLoading()}})},dealShowOfNewest:function(e){if(0==e.length)return this.pageData.showOfNewest=[],void this.setData({pageData:this.pageData});for(var a=[],t=0;t<e.length;t++){var i={};i.id=e[t].id,i.typeName=this.dealMsgType(e[t].type),i.messageTitle=e[t].messageTitle,i.messageContent=e[t].messageContent,i.messageSendTime=e[t].messageSendTime,i.msg=0==e[t].messageRead?"未读":"已读",i.messageRead=e[t].messageRead,i.type=e[t].type,i.childType=e[t].childType,i.extras=e[t].extras,i.wxMessagePageValue=e[t].wxMessagePageValue,0==e[t].messageRead&&(i.image=s.msgClue),a[t]=i}console.log("array",a),this.pageData.alarmTypeNews=a,this.setData({pageData:this.pageData})},dealMsgType:function(e){var a="";switch(e){case 1:a="支付";break;case 2:a="考勤";break;case 3:a="告警";break;case 4:a="其他";break;case 5:a="公告";break;case 6:a="报修";break;default:a="未知";break}return a},bindToAllRead:function(){var e=!1,a=this.pageData;if(a.alarmTypeNews.length>0)for(var t=0;t<a.alarmTypeNews.length;t++)0==a.alarmTypeNews[t].messageRead&&(e=!0);if(e){var i={markType:this.type};this.markRead(i)}},markRead:function(e){var a=this;n.globalData.ShowMsgUtil.netErrNotice();var t=n.globalData.StorageUtil.get("userInfoCach");wx.request({url:n.globalData.RequestUrl.appoprRequestUrl.markRead,data:e,header:{token:t.token},method:"POST",success:function(e){console.log("将消息设为已读",e.data),e.data&&200==e.data.code?a.getListByType(a.type):n.globalData.ShowMsgUtil.showErrorModal("请求失败",e.data.msg,e.data.code)},fail:function(){n.globalData.ShowMsgUtil.showNoneToast("后台连接失败",2e3)}})},bindPullUp:function(){console.log("上拉刷新",this.pullDownNumber),this.getListByType(this.type,1,5*(this.pullDownNumber+1))},bindDealMsg:function(e){console.log(e),console.log(this.type);var a=e.detail.index,t=this.type,i=this.pageData.alarmTypeNews[a].childType,l=this.pageData.alarmTypeNews[a].id,n=this.pageData.alarmTypeNews[a].msg,s=""==this.pageData.alarmTypeNews[a].extras?null:this.pageData.alarmTypeNews[a].wxMessagePageValue;this.dealMsg(t,i,l,n,s)},getMore:function(e){console.log(e),n.globalData.ShowMsgUtil.showLoadToast("正在跳转",1500);var a=e.detail.index,t=(this.type,this.pageData.alarmTypeNews[a].childType,this.pageData.alarmTypeNews[a].id),i=this.pageData.alarmTypeNews[a].msg;console.log(this.pageData),"已读"!=i&&this.markRead({mid:t}),n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.indexPageUrl.messageDetailUrl+"?mid="+t,1500)},dealMsg:function(e,a,t,i,l){console.log(a,t,i);var s=l;if(!this.disabled){console.log(s);var o=n.globalData.StorageUtil.get("userInfoCach");if(this.disabled=!0,2==e&&null==o.role){var g={mid:t};"已读"!=i&&this.markRead(g),s&&(n.globalData.ShowMsgUtil.showLoadToast("正在跳转",500),1==s.msgType?1==s.childMsgType||2==s.childMsgType||3==s.childMsgType||4==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.appointmentPageUrl.attendPianoDetailUrl+"?meetingId="+s.id+"&type=2&jumpType=newsTo",500):(6==s.childMsgType||5==s.childMsgType)&&n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.appointmentPageUrl.attendPianoDetailUrl+"?meetingId="+s.id+"&type=2&conflict=1&jumpType=newsTo",500):2==s.msgType?1==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.appointmentPageUrl.attendMeetingDetailUrl+"?meetingId="+s.id+"&type=newsTo",500):2==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.indexPageUrl.approvalInfoUrl+"&type=newsTo",500):3==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.appointmentPageUrl.meetingDetailUrl+"?meetingId="+s.id+"&type=newsTo",500):4==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.indexPageUrl.approvalInfoUrl+"&type=newsTo",500):5==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.appointmentPageUrl.attendMeetingDetailUrl+"?meetingId="+s.id+"&type=newsTo",500):6==s.childMsgType?wx.hideToast():7==s.childMsgType&&n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.appointmentPageUrl.attendMeetingDetailUrl+"?meetingId="+s.id+"&type=newsTo",500):3==s.msgType?1==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.attendancePageUrl.studentClockUrl+"?planId="+s.id+"&executePlanId="+s.executePlanId,500):2==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.indexPageUrl.approvalInfoUrl,500):3==s.childMsgType&&n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.attendancePageUrl.studentStatisticsUrl+"?planId="+s.id,500):4==s.msgType||5==s.msgType&&(1==s.childMsgType||2==s.childMsgType||3==s.childMsgType||4==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.appointmentPageUrl.attendPianoDetailUrl+"?meetingId="+s.id+"&type=3&jumpType=newsTo",500):5==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.appointmentPageUrl.attendPianoDetailUrl+"?meetingId="+s.id+"&type=3&conflict=1&jumpType=newsTo",500):6==s.childMsgType?n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.indexPageUrl.approvalInfoUrl+"&type=newsTo",500):(7==s.childMsgType||8==s.childMsgType)&&n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.appointmentPageUrl.attendPianoDetailUrl+"?meetingId="+s.id+"&type=3&jumpType=newsTo",500)))}else"已读"!=i&&this.markRead({mid:t}),n.globalData.PublicUtil.navigateByUrl(n.globalData.PageUrl.indexPageUrl.messageDetailUrl+"?mid="+t,500)}}}};a.default=o}}]);