(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-indexModule-pages-paymentCode-paymentCode"],{"2c36":function(t,e,o){var a=o("24fb");e=a(!1),e.push([t.i,"body[data-v-2a5fff10],html[data-v-2a5fff10]{width:100%;height:100%}uni-page-body[data-v-2a5fff10]{background-color:#20a4f7}\n.box[data-v-2a5fff10]{background-color:#20a4f7;width:100%;height:100%;padding-top:30px;padding-left:5%;padding-right:5%;box-sizing:border-box}.c-top[data-v-2a5fff10]{position:absolute;top:-38px;left:5px;z-index:9999;width:68px;height:25px;background-color:#20a4f7}.content[data-v-2a5fff10]{width:100%;height:79%;padding-top:18px;background-color:#fff}.box-barCode[data-v-2a5fff10]{margin-top:%?-20?%;width:90%;height:160px;margin-left:5%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.barCode-pic[data-v-2a5fff10]{width:100%;height:100px\r\n  /* border: 1px red solid; */}.title[data-v-2a5fff10]{margin-top:0;color:#bbb}.box-QRCode[data-v-2a5fff10]{width:90%;height:220px;margin-left:5%;margin-bottom:%?20?%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;padding-top:0}.QRCode-pic[data-v-2a5fff10]{width:%?380?%;height:%?380?%}.bottom[data-v-2a5fff10]{\r\n  /* border: 1px red solid; */width:100%;height:%?160?%;border-top:1px #bbb solid}.bottom-left[data-v-2a5fff10]{width:34px;height:34px;border-radius:17px;background:#20a4f7;margin-left:-17px;margin-top:-17px}.bottom-right[data-v-2a5fff10]{width:34px;height:34px;border-radius:17px;background:#20a4f7;float:right;margin-top:-34px;margin-right:-17px}.bottom-content[data-v-2a5fff10]{width:100%;height:60%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;align-items:center;font-size:15px}.bottom-font[data-v-2a5fff10]{font-size:20px;color:red;margin:0 %?10?%}body.?%PAGE?%[data-v-2a5fff10]{background-color:#20a4f7}",""]),t.exports=e},4299:function(t,e,o){"use strict";var a;o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return i})),o.d(e,"a",(function(){return a}));var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",{staticClass:"page box"},[o("v-uni-view",{staticClass:"content"},[o("v-uni-view",{staticClass:"box-barCode"},[o("v-uni-canvas",{staticClass:"barCode-pic",attrs:{"canvas-id":"barcode"}}),o("v-uni-text",{staticClass:"title",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showCode()}}},[t._v(t._s(t.codes))])],1),o("v-uni-view",{staticClass:"box-QRCode"},[o("v-uni-canvas",{staticClass:"QRCode-pic",attrs:{"canvas-id":"qrcode"}}),o("v-uni-text",{staticClass:"title"},[t._v("每分钟自动刷新，限当面使用")])],1),o("v-uni-view",{staticClass:"bottom"},[o("v-uni-view",{staticClass:"bottom-left"}),o("v-uni-view",{staticClass:"bottom-right"}),o("v-uni-view",{staticClass:"bottom-content"},[t._v("余额支付")])],1)],1),t.lefticon?o("v-uni-view",{staticClass:"c-top"}):t._e()],1)},i=[]},4817:function(t,e,o){"use strict";o.r(e);var a=o("4299"),n=o("5daa");for(var i in n)"default"!==i&&function(t){o.d(e,t,(function(){return n[t]}))}(i);o("5f5c");var s,c=o("f0c5"),r=Object(c["a"])(n["default"],a["b"],a["c"],!1,null,"2a5fff10",null,!1,a["a"],s);e["default"]=r.exports},"5daa":function(t,e,o){"use strict";o.r(e);var a=o("b3ec"),n=o.n(a);for(var i in a)"default"!==i&&function(t){o.d(e,t,(function(){return a[t]}))}(i);e["default"]=n.a},"5f5c":function(t,e,o){"use strict";var a=o("6136"),n=o.n(a);n.a},6136:function(t,e,o){var a=o("2c36");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=o("4f06").default;n("472c75cc",a,!0,{sourceMap:!1,shadowMode:!1})},b3ec:function(t,e,o){"use strict";o("acd8"),o("ac1f"),o("841c"),o("1276"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=getApp(),n=o("b6f8"),i=n.barcode,s=n.qrcode,c={data:function(){return{texts:"",codes:"点击查看付款码数字",websocket:"",path:a.globalData.RequestUrl.websocketpath,lockReconnect:!1,tt:!1,timeout:1e4,timeoutObj:null,serverTimeoutObj:null,usertake:"",usersname:"",show:"",lefticon:!1,usercodename:"",usertest:"",userindex:""}},components:{},props:{},onShow:function(){var t=this,e=window.location.search;console.log(e),t.usertest=e;var o=a.globalData.StorageUtil.get("userInfoCach");if(console.log(o),""==o||""==o.username){t=this;console.log("11111111111"),e.split("?");var n=e.split("?"),i=n[1].split("&"),s=i[1];this.usersname=s.split("=");var c=i[0].split("="),r=c[1];this.usertake=r,console.log(t.usersname),t.userroleswitch(t.usersname,r),t.lefticon=!0,console.log(t.lefticon),t.userindex=1}else t.userindex=2;uni.$on("userindex",(function(e){e.value&&(t.lefticon=!0,t.setData({lefticon:!0}))})),console.log(t.lefticon),this.createWebSocket();var l=a.globalData.StorageUtil.get("userInfoCach");clearInterval(this.myTime),console.log(o),""!==o&&t.getString(l),this.myTime=setInterval((function(){t.getString(l)}),6e4)},onunload:function(){clearInterval(this.myTime),this.websocket.onclose=function(){console.log("onunload-------------socket已经关闭-------------")}},onLoad:function(){console.log("142555")},beforeDestroy:function(){var t=this;clearInterval(this.myTime),clearInterval(t.timeoutObj),t.websocket.close(),t.websocket.onclose=function(){console.log("beforeDestroy-------------socket已经关闭-------------")}},methods:{createWebSocket:function(){console.log("111111");var t=this;try{var e,o=a.globalData.StorageUtil.get("userInfoCach");console.log(t.usertest.length),e=t.usertest.length>0?t.usersname[1]:o.username,console.log(e),t.websocket=new WebSocket(t.path+"/kyzh?deviceCode=D98"+e),console.log(o.username),console.log(t.path),t.WebSocketinit()}catch(n){console.log("createWebSocket-------------连接失败，重连----------------"),t.reconnect()}},reconnect:function(){var t=this;this.lockReconnect||(this.lockReconnect=!0,this.tt&&clearTimeout(this.tt),this.tt=setTimeout((function(){t.createWebSocket(),this.lockReconnect=!1}),1e3))},heartCheck:function(){var t=this;t.timeoutObj&&clearTimeout(t.timeoutObj),t.serverTimeoutObj&&clearTimeout(t.serverTimeoutObj),t.timeoutObj=setTimeout((function(){t.websocket.send("ping"),t.serverTimeoutObj=setTimeout((function(){console.log("heartCheck-----------没有收到pong，重连------------"),t.reconnect()}),t.timeout)}),t.timeout)},WebSocketinit:function(){var t=this;try{t.websocket.onopen=function(){console.log("websocket.onopen-------------连接成功----------------"),t.heartCheck()},t.websocket.onerror=function(){console.log("websocket.onerror-------------连接失败，重连----------------"),t.reconnect()},t.websocket.onmessage=function(e){if(console.log("websocket.onmessage--------------"+e.data+"-------------"),"pong"==e.data)t.heartCheck();else{var o=parseFloat(e.data);o&&!isNaN(o)&&(a.globalData.ShowMsgUtil.showLoadToast("正在跳转...",500),a.globalData.PublicUtil.navigateByUrl(a.globalData.PageUrl.indexPageUrl.payResults+"?status=SUCCESS&amount="+e.data+"&userindex="+t.userindex,500),t.websocket.close(),t.websocket.onclose=function(){console.log("跳转支付页面-------------socket已经关闭-------------")})}},t.websocket.onclose=function(){console.log("websocket.onclose-------------socket已经关闭，重连-------------"),t.reconnect()}}catch(e){console.log("websocket-------------绑定事件没有成功，重连----------------"),t.reconnect()}},showCode:function(){console.log(this.texts),"点击查看付款码数字"!=this.codes?this.codes="点击查看付款码数字":this.codes=this.texts},userroleswitch:function(t,e){var o=this;wx.request({url:a.globalData.RequestUrl.baseRequestUrl.switchRole,data:{username:t[1]},header:{token:e,"content-type":"application/json"},method:"POST",success:function(t){o.usertake=t.data.rows.token,console.log("console----"+o.usertake),o.usercodename=t.data.rows.username,console.log("console"+o.usercodename),o.getString()},fail:function(){a.globalData.ShowMsgUtil.showNoneToastByFail()}})},getString:function(){var t,e=this,o=a.globalData.StorageUtil.get("userInfoCach");e.usertake.length>0?(t=e.usertake,console.log("123")):t=o.token,a.globalData.ShowMsgUtil.netErrNotice(),a.globalData.ShowMsgUtil.showLoadAndMsgToast(),wx.request({url:a.globalData.RequestUrl.payRequestUrl.getCode,header:{token:t,"content-type":"application/json"},method:"POST",success:function(t){wx.hideToast({}),t.data&&200==t.data.code?(e.setData({texts:t.data.rows}),"点击查看付款码数字"!=e.codes&&e.setData({codes:t.data.rows}),s("qrcode",t.data.rows,350,350),i("barcode",t.data.rows,600,180)):a.globalData.ShowMsgUtil.showErrorModal("请求失败",t.data.msg,t.data.code)},fail:function(){wx.hideToast({}),a.globalData.ShowMsgUtil.showNoneToastByFail()}})}}};e.default=c}}]);