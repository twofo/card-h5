(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-indexModule-pages-bluetoothDemo-bluetoothDemo"],{"019d":function(e,o,t){"use strict";var c;t.d(o,"b",(function(){return n})),t.d(o,"c",(function(){return a})),t.d(o,"a",(function(){return c}));var n=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("v-uni-button",{on:{click:function(o){arguments[0]=o=e.$handleEvent(o),e.bluetooth.apply(void 0,arguments)}}},[e._v("蓝牙")])},a=[]},"782a":function(o,t,c){"use strict";c("99af"),c("ace4"),c("b420"),c("d3b7"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=getApp(),a=(n.globalData.arrayBufferDemo,n.globalData.bluetoothUtil,n.globalData.agreementUtil),s={data:function(){return{connectedDeviceId:"",services:"",serviceId:"",characteristicId:""}},components:{},props:{},onLoad:function(e){},methods:{initializeBluetooth:function(){wx.closeBluetoothAdapter({complete:function(e){console.log("关闭蓝牙模块 - ",e),wx.openBluetoothAdapter({success:function(e){console.log("初始化蓝牙设备 - ",e),wx.onBluetoothAdapterStateChange((function(e){console.log("蓝牙适配器状态变化 - ",e);var o=e.available?"蓝牙适配器可用":"蓝牙适配器不可用",t=e.discovering?"正在搜索":"搜索可用";console.log("手机蓝牙是否可用：",o),console.log("是否正在搜素",t),e.available||n.globalData.ShowMsgUtil.showErrorModal("蓝牙连接失败","手机蓝牙不可用：")})),wx.onBluetoothDeviceFound((function(e){console.log("监听寻找新设备的事件 - ",e);for(var o=0;o<e.devices.length;o++)console.log("new device list has founded"),console.log("设备id - "+e.devices[o].deviceId),console.log("设备name - "+e.devices[o].name)}))},fail:function(e){n.globalData.ShowMsgUtil.showErrorModal("蓝牙连接失败","请检查手机蓝牙是否打开"),console.log("初始化蓝牙设备 - ",e),console.log("请检查手机蓝牙是否打开")}})},fail:function(e){n.globalData.ShowMsgUtil.showErrorModal("蓝牙连接失败","请检查手机蓝牙是否打开"),console.log("关闭蓝牙模块 - ",e),console.log("请检查手机蓝牙是否打开")}})},bluetooth:function(){},searchbluetooth:function(){wx.startBluetoothDevicesDiscovery({success:function(e){console.log("开始搜索附近蓝牙设备"),console.log(e)}})},getbluetoothDevice:function(){wx.getBluetoothDevices({success:function(e){console.log("获取所有蓝牙设备"),console.log(e)}})},stopsearch:function(){wx.stopBluetoothDevicesDiscovery({success:function(e){console.log("停止蓝牙搜索"),console.log(e)}})},toConnect:function(o){var t=this;n.globalData.ShowMsgUtil.showLoadAndMsgToast("连接水表中..."),wx.createBLEConnection({deviceId:o,timeout:3e4,success:function(o){console.log(o),0==o.errCode?(console.log("连接水表: success"),t.setData({connectedDeviceId:e.currentTarget.id}),t.stopsearch()):n.globalData.ShowMsgUtil.showErrorModal("提示","不能正常对水表进行连接")},fail:function(e){wx.hideLoading(),10012==e.errCode&&n.globalData.ShowMsgUtil.showErrorModal("提示","水表连接超时"),console.warn("连接水表: fail",e)},complete:function(){wx.hideLoading()}})},getAllservice:function(e){var o=this;wx.getBLEDeviceServices({deviceId:this.connectedDeviceId,success:function(e){console.log("获取连接设备的所有服务"),console.log("device services:",e.services),o.setData({services:e.services})}})},getConnectDeviceInfo:function(){console.log("1、开始获取设备信息"),wx.getBLEDeviceServices({deviceId:that.deviceId,success:function(e){console.log("getServicesRes",e);var o=e.services[1],t=o.uuid;console.log("2、获取连接设备特征值"),wx.getBLEDeviceCharacteristics({deviceId:that.deviceId,serviceId:t,success:function(e){console.log("getCharactersRes",e);var o=e.characteristics[1],c=o.uuid;that.setData({serviceId:t,characteristicId:c}),console.log("成功获取uuId",that.serviceId,that.characteristicId),console.log("3、启用/停用 低功耗蓝牙设备特征值变化时的notify功能，订阅特征值"),wx.notifyBLECharacteristicValueChange({state:!0,deviceId:that.deviceId,serviceId:t,characteristicId:e.characteristics[0].uuid,success:function(){console.log("开始监听特征值"),wx.onBLECharacteristicValueChange((function(e){console.log("监听到特征值更新",e);var o=that.ab2hex(e.value);console.log("更新后的特征值(16进制格式)",o)}))},fail:function(e){console.warn("监听特征值失败")}})},fail:function(e){console.warn("获取特征值信息失败",e)},complete:function(e){console.log("获取服务信息完成",e),wx.hideLoading()}})},fail:function(e){console.warn("获取服务信息失败",e)},complete:function(){wx.hideLoading()}})},bluetoothCommunication:function(){},bluetoothRecevieCommand:function(){var e=this;wx.onBLECharacteristicValueChange((function(e){console.log("characteristic ".concat(e.characteristicId," has changed, now is ").concat(e.value)),console.log(a.buf2hex(e.value))})),wx.readBLECharacteristicValue({deviceId:e.connectedDeviceId,serviceId:e.serviceId,characteristicId:e.characteristicId,success:function(e){console.log("readBLECharacteristicValue:"),console.log(e)}})},bluetoothSendCommand:function(){var e=this,o=this.handlerWrite(3);wx.writeBLECharacteristicValue({deviceId:e.connectedDeviceId,serviceId:e.serviceId,characteristicId:e.characteristicId,value:o,success:function(e){console.log("writeBLECharacteristicValue success",e.errMsg)}})},handlerBluetoothCommunicationTimeout:function(){},onCloseConnect:function(){wx.closeBLEConnection({deviceId:this.deviceId,success:function(e){console.log("成功断开连接"),wx.showToast({title:"成功断开连接"})}})},handlerWrite:function(e,o){var t;switch(e){case 1:t=a.writeOpenWaterMeter(o,userId,frozenRecordId),console.log("开启水表，小程序请求");break;case 2:t=a.writeCloseWaterMeter(),console.log("关闭水表，小程序请求");break;case 3:t=a.writeWaterReportRetrue(),console.log("水表水量上报，小程序返回");break;case 4:t=a.writeIssuedByLineRetrue(o),console.log("重新下发授权额度，小程序返回");break;default:console.log("蓝牙通信指令有误");break}return t},handlerRead:function(e){var o={},t=a.readData(e);switch(console.log("operationtype - ",t),t){case"01":o=a.readOpenWaterMeter(e),console.log("读取 - 开启水表，设备返回");break;case"02":o=a.readCloseWaterMeter(e),console.log("读取 - 关闭水表，设备返回");break;case"03":o=a.readWaterReport(e),console.log("读取 - 水表水量上报，设备请求");break;case"04":o=a.readIssuedByLine(e),console.log("读取 - 重新下发授权额度，设备请求");break;default:console.log("蓝牙通信指令有误");break}return o},handlerOperation:function(e){var o=new DataView(e);o.setInt8(0,2),o.setInt8(1,2);var t=a.readData(e);switch(console.log("operationtype - ",t),t){case"01":a.writeOpenWaterMeter(10.2),console.log("开启水表，设备返回");break;case"02":a.writeCloseWaterMeter(),console.log("关闭水表，设备返回");break;case"03":a.writeWaterReportRetrue(),console.log("水表水量上报，设备请求");break;case"04":a.writeIssuedByLineRetrue(10),console.log("重新下发授权额度，设备请求");break;default:console.log("蓝牙通信指令有误");break}}}};t.default=s},8713:function(e,o,t){"use strict";t.r(o);var c=t("782a"),n=t.n(c);for(var a in c)"default"!==a&&function(e){t.d(o,e,(function(){return c[e]}))}(a);o["default"]=n.a},b420:function(e,o,t){var c=t("23e7"),n=t("621a"),a=t("a981");c({global:!0,forced:!a},{DataView:n.DataView})},fc31:function(e,o,t){"use strict";t.r(o);var c=t("019d"),n=t("8713");for(var a in n)"default"!==a&&function(e){t.d(o,e,(function(){return n[e]}))}(a);var s,i=t("f0c5"),l=Object(i["a"])(n["default"],c["b"],c["c"],!1,null,null,null,!1,c["a"],s);o["default"]=l.exports}}]);